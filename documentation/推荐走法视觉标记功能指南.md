# 推荐走法视觉标记功能使用指南

## 🎯 功能概述

现在您的中国象棋游戏已经支持在Pikafish评估后，在棋盘上用特殊标记显示推荐走法，让您能一目了然地了解下一步该如何操作。

## ✨ 新功能特点

### 1. 智能推荐标记
- 🔹 **蓝色脉动圆圈**：标记需要移动的棋子位置
- 🔸 **绿色脉动圆圈**：标记目标移动位置  
- 🔶 **橙色连接箭头**：显示移动轨迹

### 2. 自动管理
- ⏰ **自动消失**：标记将在30秒后自动消失
- 🔄 **智能更新**：每次新的评估会更新标记位置
- 💡 **用户友好**：标记不会干扰正常游戏操作

## 🎮 使用方法

### 步骤1：启动游戏
1. 运行中国象棋游戏：`java -cp "target/classes:lib/*" com.example.App`
2. 选择中国象棋模式
3. 开始新游戏或设置棋局

### 步骤2：启用AI对弈
1. 在主界面选择"启用AI对弈"
2. 选择AI类型（推荐使用"DeepSeek+Pikafish AI"）
3. 开始对弈

### 步骤3：请求Pikafish评估
1. 在游戏界面右侧找到聊天面板
2. 点击**"🐟 Pikafish评估"**按钮
3. 选择合适的难度级别（1-10级）
4. 等待评估完成

### 步骤4：查看推荐走法标记
评估完成后，您会看到：
- 📝 **文字分析**：详细的局面评估和推荐走法说明
- 🎯 **视觉标记**：棋盘上的蓝色和绿色标记显示具体位置
- 💬 **提示信息**：聊天面板中的走法提示

## 🔍 标记说明

### 蓝色标记（起始位置）
- **外观**：蓝色脉动光环
- **含义**：需要移动的棋子位置
- **特点**：带有高光效果，易于识别

### 绿色标记（目标位置）
- **外观**：绿色脉动光环，中心有星形标记
- **含义**：棋子应该移动到的目标位置
- **特点**：层次感丰富，突出重要性

### 连接箭头
- **外观**：橙色箭头，带有动画虚线效果
- **含义**：显示从起始位置到目标位置的移动轨迹
- **特点**：动态效果，直观显示移动方向

## 💡 使用技巧

### 1. 最佳使用时机
- 🤔 **犹豫不决时**：不确定下一步该如何走
- 📚 **学习阶段**：想了解专业走法的选择
- 🔍 **复杂局面**：局面复杂需要专业分析

### 2. 难度选择建议
- **1-3级（简单-困难）**：适合初学者，快速响应
- **4-6级（专家-特级）**：适合中级玩家，平衡速度和质量
- **7-10级（超级-神级）**：适合高手，深度分析但速度较慢

### 3. 结合使用建议
- 📖 **阅读分析**：先看文字分析理解走法原理
- 👀 **观察标记**：再看视觉标记确认具体位置
- 🎯 **执行操作**：按照标记提示进行移动

## 🛠️ 技术实现

### 核心功能
1. **DeepSeekPikafishAI.evaluateGameWithDetails()**
   - 获取Pikafish引擎的详细评估结果
   - 解析推荐走法的位置坐标
   - 生成包含位置信息的结构化数据

2. **ChatPanel.showRecommendedMoveHighlights()**
   - 调用BoardPanel的AI建议标记功能
   - 显示推荐走法的视觉效果
   - 管理标记的生命周期

3. **BoardPanel.setAISuggestion()**
   - 在棋盘上绘制特殊标记
   - 支持自定义标记样式和动画效果
   - 自动管理标记的显示和隐藏

### 数据结构
```java
// 推荐走法数据
RecommendedMove {
    String uciMove;           // UCI格式走法
    Position startPosition;   // 起始位置
    Position endPosition;     // 目标位置
    String description;       // 中文描述
    int rank;                // 推荐排名
}

// 评估结果数据
EvaluationResult {
    String engineAnalysis;           // 引擎分析
    String evaluation;               // 局面评估
    List<RecommendedMove> moves;     // 推荐走法列表
    String adviceText;               // 建议文本
}
```

## 🚀 进阶功能

### 1. 多个推荐走法
- 系统会分析前3个最佳走法
- 默认显示排名第一的推荐走法标记
- 可在文字分析中查看所有推荐走法

### 2. 智能适配
- 自动适配不同的棋盘翻转状态
- 正确处理红方和黑方的坐标系统
- 兼容各种棋局状态

### 3. 错误处理
- Pikafish引擎不可用时的降级处理
- 网络问题时的友好提示
- 坐标转换异常的安全处理

## 📈 性能优化

### 1. 资源管理
- AI引擎使用后自动清理资源
- 标记定时器自动管理内存
- 避免重复创建AI实例

### 2. 用户体验
- 异步处理，不阻塞界面
- 进度提示，用户感知友好
- 标记效果流畅，视觉体验佳

## 🔧 故障排除

### 常见问题

#### 1. 标记不显示
**可能原因**：
- Pikafish引擎未正确初始化
- 棋盘面板引用未正确设置
- 坐标转换出现异常

**解决方案**：
- 检查控制台日志中的错误信息
- 确保游戏正确启动并启用AI对弈
- 重启游戏重新初始化引擎

#### 2. 评估速度慢
**可能原因**：
- 选择的难度级别过高
- 系统资源不足
- Pikafish引擎性能限制

**解决方案**：
- 降低评估难度级别
- 关闭其他占用资源的程序
- 等待评估完成，避免重复点击

#### 3. 推荐走法不合理
**可能原因**：
- 引擎使用模拟模式而非真实引擎
- 局面分析深度不足
- 引擎配置参数问题

**解决方案**：
- 检查引擎初始化日志
- 增加评估难度获得更深分析
- 参考多个推荐走法进行判断

### 调试信息
启用详细日志以获得更多调试信息：
```bash
java -Ddebug=true -cp "target/classes:lib/*" com.example.App
```

## 🎉 总结

通过这个推荐走法视觉标记功能，您可以：

- 🎯 **直观学习**：通过视觉标记快速理解最佳走法
- 📚 **深度分析**：结合文字说明和视觉效果全面学习
- 🚀 **提升棋力**：借助专业引擎的分析快速提高水平
- 💡 **便捷操作**：一键获得专业级的棋局分析和建议

现在就开始使用这个功能，让您的象棋学习更加直观和高效吧！🎈
