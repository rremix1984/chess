# 可视化错误展示功能设计文档

## 📋 功能概述

为终端象棋游戏添加了可视化错误展示功能，当玩家输入错误走法时，系统会以图形化的方式直观地展示错误原因，帮助玩家更好地理解象棋规则和走法限制。

## 🎯 设计目标

1. **直观展示**：通过图形化界面清晰展示错误的起始位置和目标位置
2. **教育意义**：帮助玩家学习象棋规则，理解为什么某个走法是错误的
3. **用户友好**：提供详细的图例说明和错误分析
4. **智能提示**：展示该棋子的所有合法移动位置，给玩家参考

## 🔧 技术实现

### 核心方法

#### 1. `displayErrorVisualization(Move move, String errorMessage)`
- **功能**：主要的可视化错误展示方法
- **参数**：
  - `move`：玩家尝试的走法
  - `errorMessage`：具体的错误信息
- **实现逻辑**：
  - 绘制棋盘，用不同符号标记起始位置和目标位置
  - 根据错误类型使用不同的视觉标记
  - 显示详细的图例说明

#### 2. `displayValidMoves(Position piecePosition)`
- **功能**：展示指定棋子的所有合法移动位置
- **参数**：`piecePosition` - 棋子当前位置
- **实现逻辑**：
  - 遍历棋盘所有位置，检查是否为合法移动
  - 用特殊符号标记所有可移动位置
  - 统计并显示合法移动数量

#### 3. `displayMovePath(Position start, Position end)`
- **功能**：分析并展示移动路径上的障碍物
- **参数**：起始位置和目标位置
- **实现逻辑**：
  - 计算移动路径
  - 检查路径上是否有棋子阻挡
  - 显示具体的障碍物信息

#### 4. `isLinearMove(Position start, Position end)`
- **功能**：判断是否为直线移动（水平、垂直或对角线）
- **用途**：决定是否需要显示路径分析

### 视觉标记系统

| 符号 | 含义 | 使用场景 |
|------|------|----------|
| 🟢 | 起始位置（正确） | 起始位置有己方棋子 |
| ❌ | 起始位置（无棋子） | 起始位置为空 |
| 🚫 | 起始位置（敌方棋子） | 起始位置是对方棋子 |
| 🔴 | 目标位置（错误） | 无效的目标位置 |
| 🟡 | 目标位置（己方棋子） | 目标位置有己方棋子 |
| ⭕ | 起始=目标位置 | 起始和目标是同一位置 |
| ✅ | 可移动位置 | 该棋子的合法移动位置 |

## 🎮 用户体验

### 错误展示流程

1. **玩家输入错误走法**
   ```
   请输入走法: 马二进五
   ```

2. **系统显示错误信息**
   ```
   ❌ 无效的走法："马二进五"
   💡 错误原因：马不能从(10,2)移动到(8,5)，违反了马的移动规则
   ```

3. **可视化错误展示**
   ```
   🎯 错误可视化展示：
      一 二 三 四 五 六 七 八 九
   10 🔴车 🟢马 🔴象 🔴仕 🔴帅 🔴仕 🔴象 🔴马 🔴车 
    9 十 十 十 十 十 十 十 十 十 
    8 十 🔴炮 十 十 十 十 十 🔴炮 十 
    7 🔴兵 十 🔴兵 十 🔴兵 十 🔴兵 十 🔴兵 
    6 十 十 十 十 十 十 十 十 十 
    5 十 十 十 十 🔴 十 十 十 十 
    4 ⚫兵 十 ⚫兵 十 ⚫兵 十 ⚫兵 十 ⚫兵 
    3 十 ⚫炮 十 十 十 十 十 ⚫炮 十 
    2 十 十 十 十 十 十 十 十 十 
    1 ⚫车 ⚫马 ⚫象 ⚫士 ⚫将 ⚫士 ⚫象 ⚫马 ⚫车 
   ```

4. **图例说明**
   ```
   📖 图例说明：
   🟢 起始位置（正确）    🔴 目标位置（错误）
   ❌ 起始位置（无棋子）  🟡 目标位置（己方棋子）
   🚫 起始位置（敌方棋子）⭕ 起始=目标位置
   ```

5. **合法移动提示**
   ```
   💡 马的合法移动范围：
      一 二 三 四 五 六 七 八 九
   10 🔴车 🟢马 🔴象 🔴仕 🔴帅 🔴仕 🔴象 🔴马 🔴车 
    9 十 十 十 ✅ 十 十 十 十 十 
    8 ✅ 十 十 十 ✅ 十 十 十 十 
    7 🔴兵 十 🔴兵 十 🔴兵 十 🔴兵 十 🔴兵 
    6 十 十 十 十 十 十 十 十 十 
    5 十 十 十 十 十 十 十 十 十 
    4 ⚫兵 十 ⚫兵 十 ⚫兵 十 ⚫兵 十 ⚫兵 
    3 十 ⚫炮 十 十 十 十 十 ⚫炮 十 
    2 十 十 十 十 十 十 十 十 十 
    1 ⚫车 ⚫马 ⚫象 ⚫士 ⚫将 ⚫士 ⚫象 ⚫马 ⚫车 
   
   📊 统计：该马共有 3 个合法移动位置
   🟢 当前棋子位置    ✅ 可移动位置
   ```

## 🚀 功能特点

### 1. 多层次错误分析
- **位置验证**：检查起始和目标位置的有效性
- **棋子验证**：确认起始位置有己方棋子
- **规则验证**：验证走法是否符合棋子移动规则
- **安全验证**：检查走法是否会导致己方被将军

### 2. 智能路径分析
- **直线移动检测**：自动识别直线移动模式
- **障碍物分析**：显示移动路径上的阻挡棋子
- **路径可视化**：清晰展示移动轨迹

### 3. 教育性提示
- **合法移动展示**：显示该棋子的所有可能移动
- **统计信息**：提供移动选项数量统计
- **规则解释**：结合具体情况解释象棋规则

## 🔍 错误类型覆盖

1. **坐标超出范围**：目标位置超出棋盘边界
2. **起始位置无棋子**：选择的起始位置为空
3. **选择敌方棋子**：尝试移动对方的棋子
4. **目标位置有己方棋子**：目标位置被自己的棋子占据
5. **违反移动规则**：不符合特定棋子的移动模式
6. **路径被阻挡**：移动路径上有其他棋子
7. **导致被将军**：移动后会使己方将军处于危险状态

## 📈 用户体验提升

### 学习效果
- **直观理解**：通过可视化快速理解错误原因
- **规则学习**：在实践中学习象棋规则
- **策略提示**：了解棋子的移动能力和限制

### 操作便利性
- **即时反馈**：错误输入后立即获得详细分析
- **多角度展示**：从多个维度分析走法问题
- **友好提示**：提供改进建议和合法选项

## 🛠️ 技术亮点

### 代码设计
- **模块化设计**：功能独立，易于维护和扩展
- **高内聚低耦合**：各方法职责明确，相互依赖最小
- **可扩展性**：易于添加新的错误类型和可视化效果

### 性能优化
- **智能计算**：只在需要时计算合法移动
- **缓存机制**：避免重复计算相同位置的移动
- **渐进展示**：分层次展示信息，避免信息过载

### 健壮性
- **边界检查**：所有位置访问都进行边界验证
- **异常处理**：妥善处理各种异常情况
- **输入验证**：确保输入参数的有效性

## 🔮 后续优化方向

1. **颜色支持**：在支持的终端中使用颜色增强视觉效果
2. **动画效果**：添加简单的动画展示移动过程
3. **音效提示**：在支持的环境中添加音效反馈
4. **历史记录**：记录玩家常犯的错误，提供个性化提示
5. **难度自适应**：根据玩家水平调整提示详细程度

## 📊 测试验证

### 功能测试
- ✅ 各种错误类型的可视化展示
- ✅ 合法移动范围的正确计算和显示
- ✅ 路径分析的准确性
- ✅ 图例说明的完整性

### 用户体验测试
- ✅ 信息展示的清晰度
- ✅ 学习效果的有效性
- ✅ 操作流程的流畅性
- ✅ 错误理解的准确性

## 📝 总结

可视化错误展示功能显著提升了终端象棋游戏的用户体验和教育价值。通过直观的图形化展示，玩家能够：

1. **快速理解**错误原因
2. **学习象棋规则**和移动模式
3. **获得实用提示**改进走法
4. **享受更好的**游戏体验

该功能的实现体现了以用户为中心的设计理念，将复杂的规则验证结果转化为易于理解的可视化信息，是传统终端应用用户体验优化的成功实践。