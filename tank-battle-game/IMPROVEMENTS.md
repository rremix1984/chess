# 坦克大战游戏改进说明

## 主要改进内容

### 1. AI调用日志输出
- 在`AIDecisionService.java`中添加了详细的控制台日志输出
- 显示AI调用时的坦克信息和游戏上下文
- 打印AI决策结果和错误信息
- 当AI服务失败时，会显示使用后备策略的提示

### 2. 敌人AI行为优化
- **解决抽搐问题**：降低AI决策频率，避免过于频繁的方向改变
- **反卡住机制**：检测AI是否被障碍物包围，提供强制方向改变功能
- **平滑移动**：优化AI移动逻辑，减少不自然的移动模式
- **紧急避障**：在等待期间处理即将发生的碰撞

### 3. 障碍物碰撞系统改进
- 在`Tank.java`中添加了`tryMove`方法，带有完整的障碍物检测
- 确保不同类型障碍物的正确处理：
  - **钢板(STEEL)**：不能穿越，不能打破
  - **砖墙(BRICK)**：可以打破，但在打破前不能碰撞
  - **水域(WATER)**：不能穿越
- 玩家和AI都使用相同的碰撞检测系统

### 4. 游戏机制强化
- 更新玩家输入处理，使用新的碰撞检测系统
- AI移动逻辑全面使用`tryMove`方法
- 保持游戏规则的一致性

## 日志输出示例

运行游戏时，控制台会显示类似以下的日志：

```
[AI调用] 坦克ID: ai1, 位置: (800, 600)
[AI上下文] AI坦克位置: (800, 600), AI坦克生命值: 100, AI坦克方向: UP, 玩家坦克位置: (100, 100), 玩家坦克生命值: 100, 玩家坦克方向: RIGHT, 与玩家距离: 848, 附近障碍物数量: 2
[AI决策] 行动: MOVE, 方向: LEFT

[AI错误] 坦克 ai2 决策失败: Connection refused
[AI后备] 使用默认策略: SHOOT

[AI反卡] 坦克 ai1 强制移动到方向: RIGHT
```

## 运行说明

1. **启动游戏**：
   ```bash
   chmod +x run.sh
   ./run.sh
   ```

2. **AI功能**：
   - 如果OLLAMA服务正在运行，AI将使用大模型决策
   - 如果OLLAMA服务不可用，AI将自动切换到后备策略
   - 所有AI调用和决策都会在控制台显示详细日志

3. **游戏控制**：
   - WASD/方向键：移动坦克
   - 空格键：射击
   - 坦克无法穿越钢板、砖墙和水域
   - 只有砖墙可以被子弹打破

## 技术细节

- **AI决策频率控制**：移动决策30%概率，射击决策50%概率
- **防卡住检测**：当3个或更多方向被阻挡时认为被卡住
- **冷却时间调整**：不同情况下设置不同的移动冷却时间
- **碰撞检测优化**：使用统一的`tryMove`方法确保游戏规则一致性

这些改进显著提升了游戏的可玩性和AI行为的自然度，同时提供了详细的调试信息方便开发和维护。
